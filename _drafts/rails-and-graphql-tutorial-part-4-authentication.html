---
layout: post
title: 'Rails and GraphQL Tutorial Part 4: Authentication'
date: 
type: post
parent_id: '0'
published: false
password: ''
status: draft
categories:
- Ruby on Rails
- Tutorials
tags: []
meta:
  _wpcom_is_markdown: '1'
  _edit_last: '1'
author:
  login: admin
  email: mengledowl@gmail.com
  display_name: Matt Engledowl
  first_name: ''
  last_name: ''
permalink: "/"
---
<p>Welcome back for part 4 of our tutorial series! The topic up for discussion this time is authentication. Nearly every application needs to worry about this, and it's one of the most common questions that newcomers to GraphQL have ("how do I do authentication in GraphQL?"). I've put it off until now in favor of introducing you to the basics of creating a GraphQL API in rails, but the time has come to talk about how to authenticate requests.</p>
<h2>Part 3 Assignment Solution</h2>
<p>Before we get started, let's take a look at the questions I posed last time and I'll give my answers - see how yours match up!</p>
<p><strong>Why might I have made the name of the input type so specific to the mutation rather than more generic so it could be feasibly used in other mutations?</strong></p>
<p>To answer this, I would like to point you to <a href="https://graphqlme.com/2018/07/07/sharing-input-types-in-graphql-is-a-bad-idea/">another blog post that I wrote</a> explaining my logic behind this. Go take a look and then come back - this should pretty adequately answer the question.</p>
<p><strong>What happens if you change the line <code>argument :input, Inputs::CurrentUserUpdateInput, required: true</code> to have <code>required: false</code>?</strong></p>
<p>Not a lot - the mutation we had is still perfectly valid because going from <code>required: true</code> to <code>required: false</code> is <strong>not a breaking change</strong>. Don't believe me? Give it a try: make the change and run the query again, it should still execute!</p>
<p>There are some things that change however. For one thing, we can now remove the <code>!</code> on the input type:</p>
<pre>mutation UpdateUser($userInput: CurrentUserUpdateInput) {
  currentUserUpdate(input: $userInput) {
    id
    email
    firstName
  }
}</pre>
<p>We can also remove the input type entirely and pass nothing to the field:</p>
<pre>mutation UpdateUser {
  currentUserUpdate {
    id
    email
    firstName
  }
}</pre>
<p>However, executing this mutation throws an exception - why is that?</p>
<p>The reason lies in our resolver's method signature, which looks like this:</p>
<pre>def current_user_update(input:)</pre>
<p>We are requiring the <code>input</code> keyword argument, so when the gem calls the method, it blows up since we didn't pass it in. The solution is obviously quite simple, we just need to allow the argument to be <code>nil</code>:</p>
<pre>def current_user_update(input: nil)</pre>
<p><strong>What happens if you rename the input type to something else using <code>graphql_name</code>?</strong></p>
<p>Renaming in this way after your API has reached production is a <strong>breaking change</strong>. Doing this results in our mutation no longer being correct:</p>
<p><img class="alignnone size-large wp-image-477" src="{{ site.baseurl }}/assets/images/Screen-Shot-2018-07-07-at-7.43.52-AM-1024x674.png" alt="" width="700" height="461" /></p>
<p><strong>Can you change the name of the query variable? How?</strong></p>
<p>Absolutely! Query variables can be called whatever you want them to be. Just change it in each place that it appears, like any variable name in any programming language. Make sure to check that you changed it in each of the following places:</p>
<ul>
<li>Query Variables section</li>
<li>"variable declaration" segment (right after the name of the query/mutation - <code>UpdateUser</code> in this case)</li>
<li>Any places you use it in your actual query/mutation</li>
</ul>
<p>Of course, the type system will really shine here and help you with this, especially if you're using GraphiQL (for example):</p>
<p><img class="alignnone size-large wp-image-478" src="{{ site.baseurl }}/assets/images/Screen-Shot-2018-07-07-at-7.48.30-AM-1024x674.png" alt="" width="700" height="461" /></p>
<p><strong>What happens if you try to pass another key/value inside of the <code>userInput</code> query variable that isn't one of the available arguments on the input object?</strong></p>
<p>Two things: if you're using GraphiQL, it will give you red squiggly's to let you know that what you're doing isn't valid, and if you actually submit, it won't let the mutation through and will blow up before it hits your resolver:</p>
<p><img class="alignnone size-large wp-image-479" src="{{ site.baseurl }}/assets/images/Screen-Shot-2018-07-07-at-7.54.35-AM-1024x684.png" alt="" width="700" height="468" /></p>
<p><strong>Can you pass multiple arguments at once inside of the <code>userInput</code> query variable?</strong></p>
<p>Yes!</p>
